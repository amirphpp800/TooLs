<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>پنل مدیریت | Pro TooLs</title>
  <link rel="stylesheet" href="admin.css" />
</head>
<body>
  <div id="app">
    <header class="admin-header">
      <div class="brand"><span lang="en">Pro TooLs</span> | پنل مدیریت</div>
      <nav class="admin-nav">
        <a href="/" class="btn btn-back">بازگشت به سایت</a>
        <button id="btn-logout" class="btn btn-danger" hidden>خروج</button>
      </nav>
    </header>

    <main class="admin-main">
      <!-- Login Section -->
      <section id="login-section" class="login-container">
        <!-- Login Card -->
        <div class="card login-card">
          <div class="login-hero">
            <h1 class="card-title">ورود مدیر</h1>
            <p class="card-sub">برای دسترسی به پنل مدیریت وارد شوید</p>
          </div>
          <form id="login-form" class="form">
            <label class="form-field">
              <span>نام کاربری</span>
              <input type="text" name="username" required autocomplete="username" />
            </label>
            <label class="form-field">
              <span>رمز عبور</span>
              <input type="password" name="password" required autocomplete="current-password" />
            </label>
            <button type="submit" class="btn btn-primary" style="width:100%">ورود</button>
          </form>
        </div>

        <!-- System Status Card -->
        <div class="card status-card">
          <h3 class="card-title">وضعیت سیستم</h3>
          <div id="health" class="health">
            <div class="health-item" data-key="kv">
              <span class="health-label">پایگاه داده (KV):</span>
              <span class="status">در حال بررسی...</span>
            </div>
            <div class="health-item" data-key="adminEnv">
              <span class="health-label">تنظیمات مدیر:</span>
              <span class="status">در حال بررسی...</span>
            </div>
            <div class="health-item" data-key="secret">
              <span class="health-label">کلید امنیتی:</span>
              <span class="status">در حال بررسی...</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Dashboard -->
      <section id="dashboard-section" class="dashboard hidden" style="display: none;">
        <aside class="sidebar">
          <div class="sidebar-header">
            <h3>📊 پنل مدیریت</h3>
          </div>
          <button class="sidebar-link active" data-view="dashboard">
            <span class="sidebar-icon">🏠</span>
            <span>داشبورد</span>
          </button>
          <button class="sidebar-link" data-view="kv">
            <span class="sidebar-icon">💾</span>
            <span>مدیریت محتوا (KV)</span>
          </button>
          <button class="sidebar-link" data-view="post">
            <span class="sidebar-icon">✍️</span>
            <span>پست جدید</span>
          </button>
          <button class="sidebar-link" data-view="templates">
            <span class="sidebar-icon">📋</span>
            <span>تمپلیت‌های آماده</span>
          </button>
          <button class="sidebar-link" data-view="content-manager">
            <span class="sidebar-icon">📚</span>
            <span>مدیریت محتوا</span>
          </button>
          <button class="sidebar-link" data-view="files">
            <span class="sidebar-icon">📁</span>
            <span>مدیریت فایل</span>
          </button>
          <button class="sidebar-link" data-view="contacts">
            <span class="sidebar-icon">📞</span>
            <span>تماس‌ها</span>
          </button>
          <button class="sidebar-link" data-view="sponsors">
            <span class="sidebar-icon">🤝</span>
            <span>اسپانسرها</span>
          </button>
          <button class="sidebar-link" data-view="settings">
            <span class="sidebar-icon">⚙️</span>
            <span>تنظیمات</span>
          </button>
          <button class="sidebar-link" data-view="pages">
            <span class="sidebar-icon">📄</span>
            <span>فایل‌های استاتیک</span>
          </button>
        </aside>

        <section class="content">
          <!-- Dashboard Overview -->
          <div id="view-dashboard" class="view" role="region" aria-label="داشبورد">
            <div class="dashboard-header">
              <h2>📊 داشبورد مدیریت</h2>
              <p class="dashboard-subtitle">خلاصه‌ای از وضعیت سایت و آمار کلی</p>
            </div>
            
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">📄</div>
                <div class="stat-info">
                  <h3 id="articles-count">-</h3>
                  <p>مقالات</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">📰</div>
                <div class="stat-info">
                  <h3 id="news-count">-</h3>
                  <p>اخبار</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">⚙️</div>
                <div class="stat-info">
                  <h3 id="configs-count">-</h3>
                  <p>کانفیگ‌ها</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">📁</div>
                <div class="stat-info">
                  <h3 id="files-count">-</h3>
                  <p>فایل‌ها</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">👤</div>
                <div class="stat-info">
                  <h3 id="users-count">-</h3>
                  <p>کاربران ثبت‌نام‌شده</p>
                </div>
              </div>
            </div>

            <div class="quick-actions">
              <h3>🚀 عملیات سریع</h3>
              <div class="quick-actions-grid">
                <button class="quick-action-btn" onclick="switchView('post')">
                  <span class="quick-icon">✍️</span>
                  <span>نوشتن پست جدید</span>
                </button>
                <button class="quick-action-btn" onclick="switchView('templates')">
                  <span class="quick-icon">📋</span>
                  <span>استفاده از تمپلیت</span>
                </button>
                <button class="quick-action-btn" onclick="switchView('files')">
                  <span class="quick-icon">📁</span>
                  <span>آپلود فایل</span>
                </button>
                <button class="quick-action-btn" onclick="switchView('content-manager')">
                  <span class="quick-icon">📚</span>
                  <span>مدیریت محتوا</span>
                </button>
              </div>
            </div>

            <div class="recent-activity">
              <h3>📈 فعالیت‌های اخیر</h3>
              <div id="recent-activity-list" class="activity-list">
                <p class="loading-text">در حال بارگذاری...</p>
              </div>
            </div>
          </div>

          <!-- Content Manager -->
          <div id="view-content-manager" class="view" role="region" aria-label="مدیریت محتوا" hidden>
            <div class="toolbar">
              <div class="group">
                <strong>📚 مدیریت محتوا پیشرفته</strong>
              </div>
              <div class="group">
                <select id="content-type-filter" class="input">
                  <option value="all">همه محتوا</option>
                  <option value="articles">مقالات</option>
                  <option value="news">اخبار</option>
                  <option value="configs">کانفیگ‌ها</option>
                  <option value="downloads">دانلودها</option>
                </select>
                <button id="btn-load-content" class="btn btn-primary">بارگذاری</button>
                <button id="btn-refresh-content" class="btn btn-secondary">🔄 تازه‌سازی</button>
              </div>
            </div>

            <div class="content-grid" id="content-grid">
              <p class="loading-text">محتوایی برای نمایش وجود ندارد</p>
            </div>

            <div class="content-pagination" id="content-pagination" style="display: none;">
              <button id="btn-prev-page" class="btn btn-secondary">قبلی</button>
              <span id="page-info">صفحه 1 از 1</span>
              <button id="btn-next-page" class="btn btn-secondary">بعدی</button>
            </div>
          </div>

          <!-- Settings -->
          <div id="view-settings" class="view" role="region" aria-label="تنظیمات" hidden>
            <div class="toolbar">
              <div class="group">
                <strong>⚙️ تنظیمات سیستم</strong>
              </div>
            </div>

            <div class="settings-sections">
              <div class="form-section">
                <h3>🎨 تنظیمات ظاهری</h3>
                <div class="form-grid">
                  <label class="form-field">
                    <span>نام سایت</span>
                    <input type="text" id="site-name" placeholder="Pro TooLs" />
                  </label>
                  <label class="form-field">
                    <span>رنگ اصلی</span>
                    <input type="color" id="primary-color" value="#bdbdbd" />
                  </label>
                </div>
              </div>

              <div class="form-section">
                <h3>🔧 تنظیمات عملکردی</h3>
                <div class="form-grid">
                  <label class="form-field">
                    <span>فعال‌سازی جستجو</span>
                    <select id="search-enabled">
                      <option value="true">فعال</option>
                      <option value="false">غیرفعال</option>
                    </select>
                  </label>
                  <label class="form-field">
                    <span>تعداد مقالات در صفحه</span>
                    <input type="number" id="articles-per-page" value="10" min="5" max="50" />
                  </label>
                </div>
              </div>

              <div class="actions">
                <button id="btn-save-settings" class="btn btn-primary">💾 ذخیره تنظیمات</button>
                <button id="btn-reset-settings" class="btn btn-danger">🔄 بازنشانی</button>
              </div>
            </div>
          </div>

          <!-- KV Manager -->
          <div id="view-kv" class="view" role="region" aria-label="مدیریت محتوا">
            <div class="toolbar">
              <div class="group">
                <input id="prefix" class="input" placeholder="Prefix مثال: articles/ یا pages/" />
                <button id="btn-list" class="btn">لیست</button>
              </div>
              <div class="group">
                <label for="template-select">تمپلیت:</label>
                <select id="template-select" class="input">
                  <option value="">— انتخاب تمپلیت —</option>
                  <option value="article">محتوای مقاله (JSON)</option>
                  <option value="page">صفحه استاتیک (HTML)</option>
                  <option value="settings">تنظیمات (JSON)</option>
                </select>
                <button id="btn-apply-template" class="btn">اعمال تمپلیت</button>
              </div>
              <div class="group">
                <input id="kv-key" class="input" placeholder="کلید (key)" />
                <button id="btn-get" class="btn">دریافت</button>
                <button id="btn-delete" class="btn btn-danger">حذف</button>
              </div>
            </div>

            <div class="editor">
              <textarea id="kv-value" placeholder='محتوا (JSON یا متن عادی). برای JSON از ساختار درست استفاده کنید.'></textarea>
            </div>
            <div class="actions">
              <button id="btn-put" class="btn btn-primary">ذخیره/بروزرسانی</button>
              <button id="btn-kv-draft-save" class="btn">ذخیره پیش‌نویس</button>
              <button id="btn-kv-draft-load" class="btn">بارگذاری پیش‌نویس</button>
              <button id="btn-kv-draft-clear" class="btn btn-danger">پاک‌کردن پیش‌نویس</button>
            </div>

            <div class="list" id="kv-list"></div>
          </div>

          <!-- Contacts Manager -->
          <div id="view-contacts" class="view" role="region" aria-label="تماس‌ها" hidden>
            <div class="toolbar">
              <div class="group">
                <strong>تماس با ما (تلگرام):</strong>
              </div>
            </div>
            <form id="contacts-form" class="form form-grid">
              <label class="form-field">
                <span>عنوان ۱</span>
                <input type="text" id="c1-label" placeholder="تماس با ما - Minimalcraft" />
              </label>
              <label class="form-field">
                <span>لینک ۱</span>
                <input type="url" id="c1-url" placeholder="https://t.me/Minimalcraft" />
              </label>
              <label class="form-field">
                <span>عنوان ۲</span>
                <input type="text" id="c2-label" placeholder="تماس با ما - NeoDebug" />
              </label>
              <label class="form-field">
                <span>لینک ۲</span>
                <input type="url" id="c2-url" placeholder="https://t.me/NeoDebug" />
              </label>
              <div class="actions">
                <button type="button" id="btn-contacts-load" class="btn">دریافت</button>
                <button type="button" id="btn-contacts-save" class="btn btn-primary">ذخیره</button>
              </div>
              <p class="form-hint">در KV با کلید <code>settings/contacts.json</code> ذخیره می‌شود.</p>
            </form>
          </div>

          <!-- Sponsors Manager -->
          <div id="view-sponsors" class="view" role="region" aria-label="اسپانسرها" hidden>
            <div class="toolbar">
              <div class="group"><strong>لیست اسپانسرها</strong></div>
              <div class="group"><button type="button" id="btn-sp-add" class="btn">+ افزودن</button></div>
            </div>
            <div id="sponsors-list" class="list"></div>
            <div class="actions">
              <button type="button" id="btn-sp-load" class="btn">دریافت</button>
              <button type="button" id="btn-sp-save" class="btn btn-primary">ذخیره همه</button>
            </div>
            <p class="form-hint">در KV با کلید <code>settings/sponsors.json</code> ذخیره می‌شود. هر مورد شامل name و url است.</p>
          </div>

          <!-- Post Wizard -->
          <div id="view-post" class="view" role="region" aria-label="پست جدید" hidden>
            <div class="toolbar">
              <div class="group"><strong>ساخت پست جدید (ساده برای افراد غیر فنی)</strong></div>
              <div class="group"><button type="button" id="btn-post-generate-key" class="btn">تولید کلید</button></div>
            </div>
            <form id="post-form" class="form form-grid">
              <label class="form-field">
                <span>عنوان</span>
                <input type="text" id="post-title" placeholder="مثلاً: راه‌اندازی DNS سریع" />
              </label>
              <label class="form-field">
                <span>کاور (URL)</span>
                <input type="url" id="post-cover" placeholder="/Articles/covers/cover.jpg" />
              </label>
              <label class="form-field" style="grid-column:1/-1;">
                <span>خلاصه کوتاه</span>
                <input type="text" id="post-summary" placeholder="چند خط درباره این پست" />
              </label>
              <label class="form-field" style="grid-column:1/-1;">
                <span>برچسب‌ها (با ویرگول جدا کنید)</span>
                <input type="text" id="post-tags" placeholder="dns, راهنما, آموزش" />
              </label>
              <label class="form-field" style="grid-column:1/-1;">
                <span>متن کامل</span>
                <textarea id="post-body" placeholder="متن پست..." style="min-height:220px;"></textarea>
              </label>
              <label class="form-field" style="grid-column:1/-1;">
                <span>کلید ذخیره (KV)</span>
                <input type="text" id="post-key" placeholder="articles/YYYY/MM/slug.json" />
              </label>
              <div class="actions" style="grid-column:1/-1;">
                <button type="button" id="btn-post-preview" class="btn">پیش‌نمایش</button>
                <button type="button" id="btn-post-save-kv" class="btn btn-primary">ذخیره در KV</button>
                <button type="button" id="btn-post-draft-save" class="btn">ذخیره پیش‌نویس محلی</button>
                <button type="button" id="btn-post-draft-load" class="btn">بارگذاری پیش‌نویس</button>
                <button type="button" id="btn-post-draft-clear" class="btn btn-danger">پاک‌کردن پیش‌نویس</button>
              </div>
            </form>
            <div id="post-preview" class="card" style="margin-top:12px; display:none;">
              <h3 class="card-title">پیش‌نمایش</h3>
              <div id="post-preview-content" class="about-text"></div>
            </div>
          </div>

          <!-- Templates Manager -->
          <div id="view-templates" class="view" role="region" aria-label="تمپلیت‌ها" hidden>
            <div class="toolbar">
              <div class="group"><strong>تمپلیت‌های آماده</strong></div>
              <div class="group"><button type="button" id="btn-template-new" class="btn">+ تمپلیت جدید</button></div>
            </div>
            
            <div class="templates-grid">
              <div class="template-card" data-template="article">
                <div class="template-icon">📄</div>
                <h3>مقاله آموزشی</h3>
                <p>برای نوشتن راهنما و آموزش‌های فنی</p>
                <button class="btn btn-primary" onclick="applyTemplate('article')">استفاده</button>
              </div>
              
              <div class="template-card" data-template="news">
                <div class="template-icon">📰</div>
                <h3>خبر و اطلاعیه</h3>
                <p>برای انتشار اخبار و اطلاعیه‌ها</p>
                <button class="btn btn-primary" onclick="applyTemplate('news')">استفاده</button>
              </div>
              
              <div class="template-card" data-template="config">
                <div class="template-icon">⚙️</div>
                <h3>کانفیگ و تنظیمات</h3>
                <p>برای اشتراک کانفیگ‌های VPN و تنظیمات</p>
                <button class="btn btn-primary" onclick="applyTemplate('config')">استفاده</button>
              </div>
              
              <div class="template-card" data-template="download">
                <div class="template-icon">⬇️</div>
                <h3>صفحه دانلود</h3>
                <p>برای معرفی و دانلود نرم‌افزارها</p>
                <button class="btn btn-primary" onclick="applyTemplate('download')">استفاده</button>
              </div>
            </div>
          </div>

          <!-- File Manager -->
          <div id="view-files" class="view" role="region" aria-label="مدیریت فایل" hidden>
            <div class="toolbar">
              <div class="group"><strong>مدیریت فایل‌ها</strong></div>
              <div class="group">
                <input type="file" id="file-upload" multiple style="display:none" />
                <button type="button" id="btn-upload" class="btn">آپلود فایل</button>
              </div>
            </div>
            
            <div class="upload-area" id="upload-area">
              <div class="upload-content">
                <div class="upload-icon">📁</div>
                <p>فایل‌ها را اینجا بکشید یا کلیک کنید</p>
                <small>پشتیبانی از تصاویر، فایل‌های متنی و اسناد</small>
              </div>
            </div>
            
            <div class="files-list" id="files-list"></div>
          </div>

          <!-- Static Pages (read-only helper) -->
          <div id="view-pages" class="view" role="region" aria-label="فایل‌های استاتیک" hidden>
            <p>این بخش تنها جهت نمایش ساختار فعلی سایت است. مدیریت اصلی از طریق KV انجام می‌شود.</p>
            <ul class="tree">
              <li>/index.html</li>
              <li>/Pages/
                <ul>
                  <li>android/</li>
                  <li>ios/</li>
                  <li>windows/</li>
                  <li>web-panel/</li>
                  <li>python-panel.html</li>
                </ul>
              </li>
              <li>/Articles/ (در صورت نیاز می‌توانید محتوا را در KV با prefix: articles/ نگهداری کنید)</li>
            </ul>
          </div>
        </section>
      </section>
    </main>
  </div>

  <template id="tpl-item">
    <div class="kv-item">
      <div class="kv-key"></div>
      <div class="kv-actions">
        <button data-act="load" class="btn btn-xs">بازکردن</button>
        <button data-act="remove" class="btn btn-xs btn-danger">حذف</button>
      </div>
    </div>
  </template>

  <script src="admin.js"></script>
</body>
</html>
